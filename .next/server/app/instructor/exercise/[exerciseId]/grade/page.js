(()=>{var e={};e.id=4418,e.ids=[4418],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},57310:e=>{"use strict";e.exports=require("url")},80148:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>c});var r=t(67096),a=t(16132),i=t(37284),l=t.n(i),d=t(32564),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);t.d(s,n);let c=["",{children:["instructor",{children:["exercise",{children:["[exerciseId]",{children:["grade",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,9989)),"C:\\Users\\admin\\projects\\grading-app\\app\\instructor\\exercise\\[exerciseId]\\grade\\page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,66611)),"C:\\Users\\admin\\projects\\grading-app\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\Users\\admin\\projects\\grading-app\\app\\instructor\\exercise\\[exerciseId]\\grade\\page.tsx"],x="/instructor/exercise/[exerciseId]/grade/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/instructor/exercise/[exerciseId]/grade/page",pathname:"/instructor/exercise/[exerciseId]/grade",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},81411:(e,s,t)=>{Promise.resolve().then(t.bind(t,2691))},2691:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ExerciseGradingPage});var r=t(30784),a=t(9885),i=t(57114),l=t(51831),d=t(79803),n=t(92032),c=t(52995),o=t(93680),x=t(69518),m=t(11619),u=t(65688),h=t(59494),g=t(11440),b=t.n(g),p=t(93935),j=t(7152);function ExerciseGradingPage(){let e=(0,i.useParams)();(0,i.useRouter)();let s=e.exerciseId,[t,g]=(0,a.useState)(null),[f,v]=(0,a.useState)([]),[N,y]=(0,a.useState)(null),[w,P]=(0,a.useState)({}),[S,_]=(0,a.useState)(""),[C,k]=(0,a.useState)(!1),[E,G]=(0,a.useState)(""),[I,L]=(0,a.useState)(!0),[q,Z]=(0,a.useState)(null),[$,F]=(0,a.useState)(!1);(0,a.useEffect)(()=>{fetchExercise(),fetchStudents()},[s]);let fetchExercise=async()=>{try{let e=await fetch(`/api/exercises/${s}`);if(!e.ok)throw Error("Failed to fetch exercise");let t=await e.json();g(t.exercise)}catch(e){console.error("Error fetching exercise:",e),Z("Failed to load exercise")}},fetchStudents=async()=>{try{L(!0);let e=await fetch(`/api/exercises/${s}/students`);if(!e.ok)throw Error("Failed to fetch students");let t=await e.json();v(t.students)}catch(e){console.error("Error fetching students:",e),Z("Failed to load students")}finally{L(!1)}};(0,a.useEffect)(()=>{if(N){if(N.grade){_(N.grade.feedback||"");let e={};N.grade.criteriaGrades.forEach(s=>{e[s.criteriaId]={levelId:s.levelId,points:s.points,comments:s.comments||""}}),P(e)}else _(""),P({})}},[N]);let handleGradeChange=(e,s,t)=>{P(r=>({...r,[e]:{...r[e],levelId:s,points:t,comments:r[e]?.comments||""}}))},handleCommentsChange=(e,s)=>{P(t=>({...t,[e]:{...t[e],comments:s}}))},calculateTotalPoints=()=>t?t.rubric.criteria.reduce((e,s)=>{let t=w[s.id];return e+(t?.points||0)},0):0,calculatePercentage=()=>{if(!t)return 0;let e=calculateTotalPoints();return Math.round(e/t.maxPoints*100)},getLetterGrade=e=>e>=90?"A":e>=80?"B":e>=70?"C":e>=60?"D":"F",handleSave=async()=>{if(!N||!t){Z("Please select a student and ensure exercise is loaded");return}try{F(!0),Z(null);let e=calculateTotalPoints(),s=calculatePercentage(),r=getLetterGrade(s),a=Object.entries(w).map(([e,s])=>({criteriaId:e,levelId:s.levelId,points:s.points,comments:s.comments})),i=await fetch("/api/grades",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:N.id,lessonId:t.lesson.id,exerciseId:t.id,criteriaGrades:a,totalPoints:e,maxPossiblePoints:t.maxPoints,percentage:s,letterGrade:r,feedback:S,gradedBy:"Instructor"})});if(!i.ok){let e=await i.json();throw Error(e.error||"Failed to save grade")}k(!0),setTimeout(()=>k(!1),3e3),await fetchStudents();let l=f.find(e=>e.id===N.id);l&&y(l)}catch(e){console.error("Error saving grade:",e),Z(e instanceof Error?e.message:"Failed to save grade")}finally{F(!1)}},T=f.filter(e=>e.name.toLowerCase().includes(E.toLowerCase())||e.registrationNumber.toLowerCase().includes(E.toLowerCase())||e.email&&e.email.toLowerCase().includes(E.toLowerCase()));if(!t)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx(l.Z,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Exercise not found"}),r.jsx("p",{className:"text-gray-600",children:"The requested exercise could not be found."})]})});let A=calculateTotalPoints(),M=calculatePercentage(),O=getLetterGrade(M);return r.jsx(j.Z,{requiredRole:["instructor","admin"],children:(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[r.jsx(p.Z,{}),r.jsx("div",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between py-4 gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[t&&(0,r.jsxs)(b(),{href:`/instructor/lesson/${t.lesson.id}`,className:"flex items-center text-gray-600 hover:text-blue-600 transition-colors",children:[r.jsx(d.Z,{className:"h-4 w-4 mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:"Back to Lesson"}),r.jsx("span",{className:"sm:hidden",children:"Back"})]}),t&&r.jsx("div",{className:"h-6 w-px bg-gray-300"}),(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:t?.title||"Loading..."}),t&&(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[t.lesson.course.title," • Lesson ",t.lesson.number,":"," ",t.lesson.title]})]})]}),N&&(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[C&&(0,r.jsxs)("div",{className:"flex items-center text-green-600 bg-green-50 px-3 py-2 rounded-lg",children:[r.jsx(n.Z,{className:"h-4 w-4 mr-2"}),r.jsx("span",{className:"text-sm font-medium",children:"Saved!"})]}),(0,r.jsxs)("button",{onClick:handleSave,disabled:$,className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-2.5 rounded-lg text-sm font-semibold hover:shadow-lg transition-all duration-200 flex items-center hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(c.Z,{className:"h-4 w-4 mr-2"}),$?"Saving...":"Save Grade"]})]})]})})}),r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[r.jsx("div",{className:"lg:col-span-1",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[r.jsx(o.Z,{className:"h-5 w-5 text-blue-600"}),r.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Students"})]}),(0,r.jsxs)("div",{className:"relative mb-4",children:[r.jsx(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search students...",value:E,onChange:e=>G(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),q&&r.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded mb-4 text-sm",children:q}),I&&(0,r.jsxs)("div",{className:"flex justify-center items-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),r.jsx("span",{className:"ml-2 text-gray-600 text-sm",children:"Loading students..."})]}),!I&&!q&&r.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===T.length?r.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:E?"No students found matching your search.":"No students enrolled."}):T.map(e=>(0,r.jsxs)("button",{onClick:()=>y(e),className:`w-full text-left p-3 rounded-md border transition-colors duration-200 ${N?.id===e.id?"border-blue-500 bg-blue-50 text-blue-900":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[r.jsx("div",{className:"font-medium",children:e.name}),r.jsx("div",{className:"text-sm text-gray-600",children:e.registrationNumber}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[e.submission&&r.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:"Submitted"}),e.grade&&r.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:"Graded"})]})]},e.id))})]})}),r.jsx("div",{className:"lg:col-span-3",children:N?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:r.jsx(o.Z,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:N.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[N.registrationNumber,N.cohort&&` • ${N.cohort.name}`]})]})]}),N.grade&&(0,r.jsxs)("div",{className:"text-right",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600",children:N.grade.letterGrade}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[N.grade.totalPoints,"/",t.maxPoints," points"]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200 mb-4",children:[r.jsx("p",{className:"font-medium text-gray-900 mb-1",children:t.title}),t.description&&r.jsx("p",{className:"text-sm text-gray-600",children:t.description})]}),N.submission&&r.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(m.Z,{className:"h-4 w-4 text-blue-600"}),r.jsx("span",{className:"font-medium text-gray-900",children:"Submission"})]}),(0,r.jsxs)("a",{href:N.submission.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm flex items-center space-x-1",children:[r.jsx("span",{children:"View on GitHub"}),r.jsx(u.Z,{className:"h-3 w-3"})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Submitted:"," ",new Date(N.submission.submittedAt).toLocaleDateString()]})]}),r.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${"approved"===N.submission.status?"bg-green-100 text-green-700":"needs_revision"===N.submission.status?"bg-yellow-100 text-yellow-700":"rejected"===N.submission.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:N.submission.status})]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Assessment Rubric"}),(0,r.jsxs)(b(),{href:`/instructor/rubric/${t.rubric.id}/edit`,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[r.jsx(h.Z,{className:"h-4 w-4 mr-2"}),"Edit Rubric"]})]}),r.jsx("div",{className:"space-y-6",children:t.rubric.criteria.map(e=>(0,r.jsxs)("div",{className:"border-2 border-gray-200 rounded-xl p-5 hover:border-blue-300 transition-colors",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"font-semibold text-gray-900 text-lg",children:e.name}),(0,r.jsxs)("span",{className:"bg-blue-100 text-blue-700 text-xs font-medium px-2 py-1 rounded-full",children:[e.weight,"% weight"]})]}),e.description&&r.jsx("p",{className:"text-sm text-gray-600",children:e.description})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:t.rubric.levels.map(s=>{let t=w[e.id]?.levelId===s.id;return(0,r.jsxs)("button",{onClick:()=>handleGradeChange(e.id,s.id,s.points),className:`p-4 rounded-lg border-2 text-left transition-all duration-200 ${t?s.color?`${s.color} border-current shadow-md scale-105`:"bg-blue-50 text-blue-800 border-blue-500 shadow-md scale-105":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 hover:shadow-sm"}`,children:[r.jsx("div",{className:"font-semibold text-sm mb-1",children:s.name}),s.description&&r.jsx("div",{className:"text-xs text-gray-600 mb-2",children:s.description}),(0,r.jsxs)("div",{className:"text-xs font-medium opacity-75",children:[s.points," points"]})]},s.id)})}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Feedback Comments"}),r.jsx("textarea",{value:w[e.id]?.comments||"",onChange:s=>handleCommentsChange(e.id,s.target.value),className:"w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",rows:3,placeholder:"Add specific feedback for this criteria..."})]})]},e.id))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Overall Feedback"}),r.jsx("textarea",{value:S,onChange:e=>_(e.target.value),className:"w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",rows:4,placeholder:"Provide overall feedback for the student's work..."})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl shadow-lg p-6 text-white",children:[r.jsx("h3",{className:"text-lg font-bold mb-6",children:"Grade Summary"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"text-center bg-white/10 rounded-lg p-4 backdrop-blur-sm",children:[r.jsx("div",{className:"text-3xl font-bold",children:A}),r.jsx("div",{className:"text-sm opacity-90 mt-1",children:"Points Earned"})]}),(0,r.jsxs)("div",{className:"text-center bg-white/10 rounded-lg p-4 backdrop-blur-sm",children:[r.jsx("div",{className:"text-3xl font-bold",children:t.maxPoints}),r.jsx("div",{className:"text-sm opacity-90 mt-1",children:"Max Points"})]}),(0,r.jsxs)("div",{className:"text-center bg-white/10 rounded-lg p-4 backdrop-blur-sm",children:[(0,r.jsxs)("div",{className:"text-3xl font-bold",children:[M,"%"]}),r.jsx("div",{className:"text-sm opacity-90 mt-1",children:"Percentage"})]}),(0,r.jsxs)("div",{className:"text-center bg-white/10 rounded-lg p-4 backdrop-blur-sm",children:[r.jsx("div",{className:"text-3xl font-bold",children:O}),r.jsx("div",{className:"text-sm opacity-90 mt-1",children:"Letter Grade"})]})]})]})]}):(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-12 text-center border border-gray-100",children:[r.jsx("div",{className:"bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(o.Z,{className:"h-8 w-8 text-gray-400"})}),r.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Select a Student"}),r.jsx("p",{className:"text-gray-600",children:"Choose a student from the sidebar to begin grading."})]})})]})})]})})}},9989:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>l,__esModule:()=>i,default:()=>n});var r=t(95153);let a=(0,r.createProxy)(String.raw`C:\Users\admin\projects\grading-app\app\instructor\exercise\[exerciseId]\grade\page.tsx`),{__esModule:i,$$typeof:l}=a,d=a.default,n=d}};var s=require("../../../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[657,9045,1440,3528,8200,986,2741,3538,7134,3935,7152],()=>__webpack_exec__(80148));module.exports=t})();