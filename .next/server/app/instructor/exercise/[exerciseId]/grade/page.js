(()=>{var e={};e.id=4418,e.ids=[4418],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},57310:e=>{"use strict";e.exports=require("url")},80148:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>c});var r=t(67096),a=t(16132),i=t(37284),l=t.n(i),d=t(32564),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);t.d(s,n);let c=["",{children:["instructor",{children:["exercise",{children:["[exerciseId]",{children:["grade",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,9989)),"C:\\Users\\admin\\projects\\grading-app\\app\\instructor\\exercise\\[exerciseId]\\grade\\page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,66611)),"C:\\Users\\admin\\projects\\grading-app\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,44293)),"C:\\Users\\admin\\projects\\grading-app\\app\\not-found.tsx"]}],o=["C:\\Users\\admin\\projects\\grading-app\\app\\instructor\\exercise\\[exerciseId]\\grade\\page.tsx"],x="/instructor/exercise/[exerciseId]/grade/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/instructor/exercise/[exerciseId]/grade/page",pathname:"/instructor/exercise/[exerciseId]/grade",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},81411:(e,s,t)=>{Promise.resolve().then(t.bind(t,2691))},2691:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ExerciseGradingPage});var r=t(30784),a=t(9885),i=t(57114),l=t(51831),d=t(79803),n=t(92032),c=t(52995),o=t(93680),x=t(69518),m=t(11619),u=t(65688),h=t(59494),g=t(11440),b=t.n(g),p=t(93935),j=t(7152);function ExerciseGradingPage(){let e=(0,i.useParams)();(0,i.useRouter)();let s=(0,i.useSearchParams)(),t=e.exerciseId,[g,f]=(0,a.useState)(null),[v,N]=(0,a.useState)([]),[y,w]=(0,a.useState)(null),[P,S]=(0,a.useState)({}),[C,_]=(0,a.useState)(""),[k,E]=(0,a.useState)(!1),[I,G]=(0,a.useState)(""),[L,q]=(0,a.useState)(!0),[Z,$]=(0,a.useState)(null),[F,T]=(0,a.useState)(!1);(0,a.useEffect)(()=>{fetchExercise(),fetchStudents()},[t]),(0,a.useEffect)(()=>{let e=s.get("studentId");if(e&&v.length>0){let s=v.find(s=>s.id===e);s&&y?.id!==e&&w(s)}},[v,s]);let fetchExercise=async()=>{try{let e=await fetch(`/api/exercises/${t}`);if(!e.ok)throw Error("Failed to fetch exercise");let s=await e.json();f(s.exercise)}catch(e){console.error("Error fetching exercise:",e),$("Failed to load exercise")}},fetchStudents=async()=>{try{q(!0);let e=await fetch(`/api/exercises/${t}/students`);if(!e.ok)throw Error("Failed to fetch students");let s=await e.json();N(s.students)}catch(e){console.error("Error fetching students:",e),$("Failed to load students")}finally{q(!1)}};(0,a.useEffect)(()=>{if(y){if(y.grade){_(y.grade.feedback||"");let e={};y.grade.criteriaGrades.forEach(s=>{e[s.criteriaId]={levelId:s.levelId,points:s.points,comments:s.comments||""}}),S(e)}else _(""),S({})}},[y]);let handleGradeChange=(e,s,t)=>{S(r=>({...r,[e]:{...r[e],levelId:s,points:t,comments:r[e]?.comments||""}}))},handleCommentsChange=(e,s)=>{S(t=>({...t,[e]:{...t[e],comments:s}}))},calculateTotalPoints=()=>g?g.rubric.criteria.reduce((e,s)=>{let t=P[s.id];return e+(t?.points||0)},0):0,calculatePercentage=()=>{if(!g)return 0;let e=calculateTotalPoints();return Math.round(e/g.maxPoints*100)},getLetterGrade=e=>e>=90?"A":e>=80?"B":e>=70?"C":e>=60?"D":"F",handleSave=async()=>{if(!y||!g){$("Please select a student and ensure exercise is loaded");return}try{T(!0),$(null);let e=calculateTotalPoints(),s=calculatePercentage(),t=getLetterGrade(s),r=Object.entries(P).map(([e,s])=>({criteriaId:e,levelId:s.levelId,points:s.points,comments:s.comments})),a=await fetch("/api/grades",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:y.id,lessonId:g.lesson.id,exerciseId:g.id,criteriaGrades:r,totalPoints:e,maxPossiblePoints:g.maxPoints,percentage:s,letterGrade:t,feedback:C,gradedBy:"Instructor"})});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to save grade")}E(!0),setTimeout(()=>E(!1),3e3),await fetchStudents();let i=v.find(e=>e.id===y.id);i&&w(i)}catch(e){console.error("Error saving grade:",e),$(e instanceof Error?e.message:"Failed to save grade")}finally{T(!1)}},A=v.filter(e=>e.name.toLowerCase().includes(I.toLowerCase())||e.registrationNumber.toLowerCase().includes(I.toLowerCase())||e.email&&e.email.toLowerCase().includes(I.toLowerCase()));if(!g)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx(l.Z,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Exercise not found"}),r.jsx("p",{className:"text-gray-600",children:"The requested exercise could not be found."})]})});let M=calculateTotalPoints(),U=calculatePercentage(),O=getLetterGrade(U);return r.jsx(j.Z,{requiredRole:["instructor","admin"],children:(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[r.jsx(p.Z,{}),r.jsx("div",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between py-4 gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[g&&(0,r.jsxs)(b(),{href:`/instructor/lesson/${g.lesson.id}`,className:"flex items-center text-gray-600 hover:text-blue-600 transition-colors",children:[r.jsx(d.Z,{className:"h-4 w-4 mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:"Back to Lesson"}),r.jsx("span",{className:"sm:hidden",children:"Back"})]}),g&&r.jsx("div",{className:"h-6 w-px bg-gray-300"}),(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:g?.title||"Loading..."}),g&&(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[g.lesson.course.title," • Lesson ",g.lesson.number,":"," ",g.lesson.title]})]})]}),y&&(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[k&&(0,r.jsxs)("div",{className:"flex items-center text-green-600 bg-green-50 px-3 py-2 rounded-lg",children:[r.jsx(n.Z,{className:"h-4 w-4 mr-2"}),r.jsx("span",{className:"text-sm font-medium",children:"Saved!"})]}),(0,r.jsxs)("button",{onClick:handleSave,disabled:F,className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-2.5 rounded-lg text-sm font-semibold hover:shadow-lg transition-all duration-200 flex items-center hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(c.Z,{className:"h-4 w-4 mr-2"}),F?"Saving...":"Save Grade"]})]})]})})}),r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[r.jsx("div",{className:"lg:col-span-1",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[r.jsx(o.Z,{className:"h-5 w-5 text-blue-600"}),r.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Students"})]}),(0,r.jsxs)("div",{className:"relative mb-4",children:[r.jsx(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search students...",value:I,onChange:e=>G(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),Z&&r.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded mb-4 text-sm",children:Z}),L&&(0,r.jsxs)("div",{className:"flex justify-center items-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),r.jsx("span",{className:"ml-2 text-gray-600 text-sm",children:"Loading students..."})]}),!L&&!Z&&r.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===A.length?r.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:I?"No students found matching your search.":"No students enrolled."}):A.map(e=>(0,r.jsxs)("button",{onClick:()=>w(e),className:`w-full text-left p-3 rounded-md border transition-colors duration-200 ${y?.id===e.id?"border-blue-500 bg-blue-50 text-blue-900":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[r.jsx("div",{className:"font-medium",children:e.name}),r.jsx("div",{className:"text-sm text-gray-600",children:e.registrationNumber}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[e.submission&&r.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:"Submitted"}),e.grade&&r.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:"Graded"})]})]},e.id))})]})}),r.jsx("div",{className:"lg:col-span-3",children:y?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:r.jsx(o.Z,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:y.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[y.registrationNumber,y.cohort&&` • ${y.cohort.name}`]})]})]}),y.grade&&(0,r.jsxs)("div",{className:"text-right",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.grade.letterGrade}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[y.grade.totalPoints,"/",g.maxPoints," points"]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200 mb-4",children:[r.jsx("p",{className:"font-medium text-gray-900 mb-1",children:g.title}),g.description&&r.jsx("p",{className:"text-sm text-gray-600",children:g.description})]}),y.submission&&r.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(m.Z,{className:"h-4 w-4 text-blue-600"}),r.jsx("span",{className:"font-medium text-gray-900",children:"Submission"})]}),(0,r.jsxs)("a",{href:y.submission.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm flex items-center space-x-1",children:[r.jsx("span",{children:"View on GitHub"}),r.jsx(u.Z,{className:"h-3 w-3"})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Submitted:"," ",new Date(y.submission.submittedAt).toLocaleDateString()]})]}),r.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${"approved"===y.submission.status?"bg-green-100 text-green-700":"needs_revision"===y.submission.status?"bg-yellow-100 text-yellow-700":"rejected"===y.submission.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:y.submission.status})]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Assessment Rubric"}),(0,r.jsxs)(b(),{href:`/instructor/rubric/${g.rubric.id}/edit`,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[r.jsx(h.Z,{className:"h-4 w-4 mr-2"}),"Edit Rubric"]})]}),r.jsx("div",{className:"space-y-6",children:g.rubric.criteria.map(e=>(0,r.jsxs)("div",{className:"border-2 border-gray-200 rounded-xl p-5 hover:border-blue-300 transition-colors",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"font-semibold text-gray-900 text-lg",children:e.name}),(0,r.jsxs)("span",{className:"bg-blue-100 text-blue-700 text-xs font-medium px-2 py-1 rounded-full",children:[e.weight,"% weight"]})]}),e.description&&r.jsx("p",{className:"text-sm text-gray-600",children:e.description})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:g.rubric.levels.map(s=>{let t=P[e.id]?.levelId===s.id;return(0,r.jsxs)("button",{onClick:()=>handleGradeChange(e.id,s.id,s.points),className:`p-4 rounded-lg border-2 text-left transition-all duration-200 ${t?s.color?`${s.color} border-current shadow-md scale-105`:"bg-blue-50 text-blue-800 border-blue-500 shadow-md scale-105":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 hover:shadow-sm"}`,children:[r.jsx("div",{className:"font-semibold text-sm mb-1",children:s.name}),s.description&&r.jsx("div",{className:"text-xs text-gray-600 mb-2",children:s.description}),(0,r.jsxs)("div",{className:"text-xs font-medium opacity-75",children:[s.points," points"]})]},s.id)})}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Feedback Comments"}),r.jsx("textarea",{value:P[e.id]?.comments||"",onChange:s=>handleCommentsChange(e.id,s.target.value),className:"w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",rows:3,placeholder:"Add specific feedback for this criteria..."})]})]},e.id))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Overall Feedback"}),r.jsx("textarea",{value:C,onChange:e=>_(e.target.value),className:"w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",rows:4,placeholder:"Provide overall feedback for the student's work..."})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl shadow-lg p-6 text-white",children:[r.jsx("h3",{className:"text-lg font-bold mb-6",children:"Grade Summary"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"text-center bg-white/10 rounded-lg p-4 backdrop-blur-sm",children:[r.jsx("div",{className:"text-3xl font-bold",children:M}),r.jsx("div",{className:"text-sm opacity-90 mt-1",children:"Points Earned"})]}),(0,r.jsxs)("div",{className:"text-center bg-white/10 rounded-lg p-4 backdrop-blur-sm",children:[r.jsx("div",{className:"text-3xl font-bold",children:g.maxPoints}),r.jsx("div",{className:"text-sm opacity-90 mt-1",children:"Max Points"})]}),(0,r.jsxs)("div",{className:"text-center bg-white/10 rounded-lg p-4 backdrop-blur-sm",children:[(0,r.jsxs)("div",{className:"text-3xl font-bold",children:[U,"%"]}),r.jsx("div",{className:"text-sm opacity-90 mt-1",children:"Percentage"})]}),(0,r.jsxs)("div",{className:"text-center bg-white/10 rounded-lg p-4 backdrop-blur-sm",children:[r.jsx("div",{className:"text-3xl font-bold",children:O}),r.jsx("div",{className:"text-sm opacity-90 mt-1",children:"Letter Grade"})]})]})]})]}):(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-12 text-center border border-gray-100",children:[r.jsx("div",{className:"bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(o.Z,{className:"h-8 w-8 text-gray-400"})}),r.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Select a Student"}),r.jsx("p",{className:"text-gray-600",children:"Choose a student from the sidebar to begin grading."})]})})]})})]})})}},9989:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>l,__esModule:()=>i,default:()=>n});var r=t(95153);let a=(0,r.createProxy)(String.raw`C:\Users\admin\projects\grading-app\app\instructor\exercise\[exerciseId]\grade\page.tsx`),{__esModule:i,$$typeof:l}=a,d=a.default,n=d}};var s=require("../../../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[657,6309,3782,8200,986,3108,3208,7505,3935,7152],()=>__webpack_exec__(80148));module.exports=t})();