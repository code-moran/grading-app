"use strict";(()=>{var e={};e.id=4740,e.ids=[4740],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},43683:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>m,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>q});var s={};t.r(s),t.d(s,{GET:()=>GET,PATCH:()=>PATCH,POST:()=>POST});var i=t(10884),o=t(16132),n=t(95798),u=t(15204),a=t(94020),c=t(8192);async function GET(e){try{if(!u._)return console.error("Prisma client is not initialized"),n.Z.json({error:"Database connection error. Please try again later."},{status:500});let r=await (0,a.getServerSession)(c.L),{searchParams:t}=new URL(e.url),s="true"===t.get("includeSubscribed"),i=null;if(r?.user&&"student"===r.user.role){let e=await u._.student.findUnique({where:{userId:r.user.id},select:{id:!0}});i=e?.id||null}let o=await u._.course.findMany({where:{isActive:!0},include:{_count:{select:{lessons:!0,subscriptions:!0}},...r?.user&&s?{subscriptions:{where:{OR:[{userId:r.user.id,status:"active"},...i?[{studentId:i,status:"active"}]:[]]},select:{id:!0,status:!0}}}:{}},orderBy:{createdAt:"desc"}}),l=o.map(e=>({id:e.id,title:e.title,description:e.description,price:e.price,isActive:e.isActive,lessonCount:e._count.lessons,subscriberCount:e._count.subscriptions,isSubscribed:!!r?.user&&!!s&&e.subscriptions&&e.subscriptions.length>0,createdAt:e.createdAt}));return n.Z.json({courses:l})}catch(e){return console.error("Error fetching courses:",e),n.Z.json({error:"Failed to fetch courses"},{status:500})}}async function POST(e){try{let r=await (0,a.getServerSession)(c.L);if(!r?.user||"admin"!==r.user.role)return n.Z.json({error:"Unauthorized. Admin access required."},{status:403});let t=await e.json(),{title:s,description:i,basePrice:o}=t;if(!s)return n.Z.json({error:"Course title is required"},{status:400});let l=null!=o&&""!==o?1.1*parseFloat(o):null,d=await u._.course.create({data:{title:s,description:i||null,price:null!==l?l:void 0,isActive:!0}});return n.Z.json({message:"Course created successfully",course:d},{status:201})}catch(e){return console.error("Error creating course:",e),n.Z.json({error:"Failed to create course"},{status:500})}}async function PATCH(e){try{let r=await (0,a.getServerSession)(c.L);if(!r?.user||"admin"!==r.user.role)return n.Z.json({error:"Unauthorized. Admin access required."},{status:403});if(!u._)return n.Z.json({error:"Database connection error"},{status:500});let t=await e.json(),{id:s,isActive:i,title:o,description:l,basePrice:d}=t;if(!s)return n.Z.json({error:"Course ID is required"},{status:400});let p={};(void 0!==i&&(p.isActive=i),o&&(p.title=o),void 0!==l&&(p.description=l),null!=d&&""!==d)?p.price=1.1*parseFloat(d):(null===d||""===d)&&(p.price=null);let x=await u._.course.update({where:{id:s},data:p});return n.Z.json({message:"Course updated successfully",course:x})}catch(e){return console.error("Error updating course:",e),n.Z.json({error:"Failed to update course"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/courses/route",pathname:"/api/courses",filename:"route",bundlePath:"app/api/courses/route"},resolvedPagePath:"C:\\Users\\admin\\projects\\grading-app\\app\\api\\courses\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:x,headerHooks:g,staticGenerationBailout:q}=l,m="/api/courses/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[657,8557,5798,7391,5226,8192],()=>__webpack_exec__(43683));module.exports=t})();