"use strict";(()=>{var e={};e.id=868,e.ids=[868],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},71548:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>g,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>f});var o={};t.r(o),t.d(o,{DELETE:()=>DELETE,POST:()=>POST});var s=t(10884),n=t(16132),i=t(95798),u=t(15204),a=t(94020),l=t(8192);async function POST(e,{params:r}){try{let t=await (0,a.getServerSession)(l.L);if(!t?.user)return i.Z.json({error:"Unauthorized"},{status:401});let o=t.user.role;if(!["admin","instructor"].includes(o))return i.Z.json({error:"Forbidden. Admin or Instructor access required."},{status:403});let s=r.id,n=await e.json(),{cohortId:d}=n;if(!d)return i.Z.json({error:"Cohort ID is required"},{status:400});let c=await u._.course.findUnique({where:{id:s}});if(!c)return i.Z.json({error:"Course not found"},{status:404});let p=await u._.cohort.findUnique({where:{id:d},include:{students:!0}});if(!p)return i.Z.json({error:"Cohort not found"},{status:404});if(0===p.students.length)return i.Z.json({error:"No students in this cohort"},{status:400});let h=await u._.$transaction(async e=>{let r=[],t=[],o=[];for(let n of p.students)try{let o=null;if(n.userId&&(o=await e.courseSubscription.findUnique({where:{userId_courseId:{userId:n.userId,courseId:s}}})),!o){let r=await e.courseSubscription.findFirst({where:{studentId:n.id,courseId:s}});r&&(o=r)}o?"active"===o.status?t.push(n.name):(await e.courseSubscription.update({where:{id:o.id},data:{status:"active",subscribedAt:new Date}}),r.push(n.name)):(await e.courseSubscription.create({data:{studentId:n.id,courseId:s,userId:n.userId||null,status:"active"}}),r.push(n.name))}catch(e){o.push(`${n.name}: ${e.message}`)}return{enrolled:r,alreadyEnrolled:t,errors:o}});return i.Z.json({success:!0,message:`Enrollment completed for cohort "${p.name}"`,enrolled:h.enrolled.length,alreadyEnrolled:h.alreadyEnrolled.length,errors:h.errors.length,details:{enrolled:h.enrolled,alreadyEnrolled:h.alreadyEnrolled,errors:h.errors}})}catch(e){return console.error("Error enrolling cohort:",e),i.Z.json({error:e.message||"Failed to enroll cohort"},{status:500})}}async function DELETE(e,{params:r}){try{let t=await (0,a.getServerSession)(l.L);if(!t?.user)return i.Z.json({error:"Unauthorized"},{status:401});let o=t.user.role;if(!["admin","instructor"].includes(o))return i.Z.json({error:"Forbidden. Admin or Instructor access required."},{status:403});let s=r.id,{searchParams:n}=new URL(e.url),d=n.get("cohortId");if(!d)return i.Z.json({error:"Cohort ID is required"},{status:400});let c=await u._.cohort.findUnique({where:{id:d},include:{students:!0}});if(!c)return i.Z.json({error:"Cohort not found"},{status:404});let p=await u._.$transaction(async e=>{let r=[],t=[];for(let o of c.students)try{let n=null;if(o.userId&&(n=await e.courseSubscription.findUnique({where:{userId_courseId:{userId:o.userId,courseId:s}}})),!n){let r=await e.courseSubscription.findFirst({where:{studentId:o.id,courseId:s}});r&&(n=r)}n?(await e.courseSubscription.update({where:{id:n.id},data:{status:"cancelled"}}),r.push(o.name)):t.push(o.name)}catch(e){console.error(`Error unenrolling ${o.name}:`,e)}return{unenrolled:r,notEnrolled:t}});return i.Z.json({success:!0,message:`Unenrollment completed for cohort "${c.name}"`,unenrolled:p.unenrolled.length,notEnrolled:p.notEnrolled.length,details:{unenrolled:p.unenrolled,notEnrolled:p.notEnrolled}})}catch(e){return console.error("Error unenrolling cohort:",e),i.Z.json({error:e.message||"Failed to unenroll cohort"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/courses/[id]/enroll-cohort/route",pathname:"/api/courses/[id]/enroll-cohort",filename:"route",bundlePath:"app/api/courses/[id]/enroll-cohort/route"},resolvedPagePath:"C:\\Users\\admin\\projects\\grading-app\\app\\api\\courses\\[id]\\enroll-cohort\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:h,headerHooks:m,staticGenerationBailout:f}=d,g="/api/courses/[id]/enroll-cohort/route"}};var r=require("../../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[657,8557,5798,7391,5226,8192],()=>__webpack_exec__(71548));module.exports=t})();