"use strict";(()=>{var e={};e.id=130,e.ids=[130],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},71971:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>x,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>b});var s={};r.r(s),r.d(s,{GET:()=>GET});var i=r(10884),o=r(16132),u=r(95798),n=r(94020),d=r(8192),a=r(15204);async function GET(e){try{let t=await (0,n.getServerSession)(d.L);if(!t?.user)return u.Z.json({error:"Unauthorized"},{status:401});let r=t.user.role;if("instructor"!==r)return u.Z.json({error:"Forbidden. Instructor access required."},{status:403});let s=await a._.instructor.findUnique({where:{userId:t.user.id},include:{courses:{include:{course:{include:{subscriptions:{where:{status:"active"},include:{user:{include:{studentProfile:{include:{cohort:{select:{id:!0,name:!0}},_count:{select:{grades:!0,quizAttempts:!0,exerciseSubmissions:!0}}}}}},student:{include:{cohort:{select:{id:!0,name:!0}},_count:{select:{grades:!0,quizAttempts:!0,exerciseSubmissions:!0}}}}}}}}}}}});if(!s)return u.Z.json({error:"Instructor profile not found"},{status:404});let{searchParams:i}=new URL(e.url),o=i.get("courseId"),c=new Map;for(let e of s.courses){let t=e.course;if(!o||t.id===o){for(let e of t.subscriptions)if(e.user?.studentProfile&&"student"===e.user.role){let r=e.user,i=r.studentProfile.id;if(c.has(i)){let r=c.get(i);r.courses.push({id:t.id,title:t.title,subscribedAt:e.subscribedAt})}else{let o=s.courses.map(e=>e.course.id),u=await a._.grade.findMany({where:{studentId:i,lesson:{courseId:{in:o}}},include:{lesson:{select:{id:!0,number:!0,title:!0,course:{select:{id:!0,title:!0}}}},exercise:{select:{id:!0,title:!0}}},orderBy:{gradedAt:"desc"}}),n=u.reduce((e,t)=>e+t.totalPoints,0),d=u.reduce((e,t)=>e+t.maxPossiblePoints,0),l=d>0?Math.round(n/d*100):0;c.set(i,{id:r.studentProfile.id,userId:r.id,name:r.studentProfile.name,email:r.studentProfile.email||r.email,registrationNumber:r.studentProfile.registrationNumber,cohortId:r.studentProfile.cohortId||void 0,cohort:r.studentProfile.cohort?{id:r.studentProfile.cohort.id,name:r.studentProfile.cohort.name}:void 0,courses:[{id:t.id,title:t.title,subscribedAt:e.subscribedAt}],stats:{totalGrades:r.studentProfile._count.grades,totalQuizAttempts:r.studentProfile._count.quizAttempts,totalSubmissions:r.studentProfile._count.exerciseSubmissions,averageGrade:l},recentGrades:u.slice(0,5)})}}else if(e.student){let r=e.student,i=r.id;if(c.has(i)){let r=c.get(i);r.courses.push({id:t.id,title:t.title,subscribedAt:e.subscribedAt})}else{let o=s.courses.map(e=>e.course.id),u=await a._.grade.findMany({where:{studentId:i,lesson:{courseId:{in:o}}},include:{lesson:{select:{id:!0,number:!0,title:!0,course:{select:{id:!0,title:!0}}}},exercise:{select:{id:!0,title:!0}}},orderBy:{gradedAt:"desc"}}),n=u.reduce((e,t)=>e+t.totalPoints,0),d=u.reduce((e,t)=>e+t.maxPossiblePoints,0),l=d>0?Math.round(n/d*100):0;c.set(i,{id:r.id,userId:void 0,name:r.name,email:r.email||"",registrationNumber:r.registrationNumber,cohortId:r.cohortId||void 0,cohort:r.cohort?{id:r.cohort.id,name:r.cohort.name}:void 0,courses:[{id:t.id,title:t.title,subscribedAt:e.subscribedAt}],stats:{totalGrades:r._count.grades,totalQuizAttempts:r._count.quizAttempts,totalSubmissions:r._count.exerciseSubmissions,averageGrade:l},recentGrades:u.slice(0,5)})}}}}let l=Array.from(c.values());return l.sort((e,t)=>e.name.localeCompare(t.name)),u.Z.json({students:l},{status:200})}catch(e){return console.error("Error fetching instructor students:",e),u.Z.json({error:"Failed to fetch students"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/instructor/students/route",pathname:"/api/instructor/students",filename:"route",bundlePath:"app/api/instructor/students/route"},resolvedPagePath:"C:\\Users\\admin\\projects\\grading-app\\app\\api\\instructor\\students\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:m,headerHooks:f,staticGenerationBailout:b}=c,x="/api/instructor/students/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[657,8557,5798,7391,5226,8192],()=>__webpack_exec__(71971));module.exports=r})();