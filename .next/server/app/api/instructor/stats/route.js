"use strict";(()=>{var e={};e.id=4416,e.ids=[4416],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},95803:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>m,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>x,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>q});var s={};r.r(s),r.d(s,{GET:()=>GET});var i=r(10884),o=r(16132),n=r(95798),u=r(94020),a=r(8192),c=r(15204);async function GET(e){try{let e=await (0,u.getServerSession)(a.L);if(!e?.user)return n.Z.json({error:"Unauthorized"},{status:401});let t=e.user.role;if("instructor"!==t)return n.Z.json({error:"Forbidden. Instructor access required."},{status:403});let r=await c._.instructor.findUnique({where:{userId:e.user.id},include:{courses:{include:{course:{include:{lessons:{include:{_count:{select:{exercises:!0,grades:!0,quizAttempts:!0,quizQuestions:!0}}}},subscriptions:{where:{status:"active"}}}}}}}});if(!r)return n.Z.json({error:"Instructor profile not found"},{status:404});let s=r.courses.map(e=>e.course),i=s.length,o=s.reduce((e,t)=>e+t.lessons.length,0),p=s.reduce((e,t)=>e+t.lessons.reduce((e,t)=>e+t._count.exercises,0),0),d=s.reduce((e,t)=>e+t.subscriptions.length,0),l=s.reduce((e,t)=>e+t.lessons.reduce((e,t)=>e+t._count.grades,0),0),x=s.reduce((e,t)=>e+t.lessons.reduce((e,t)=>e+t._count.quizAttempts,0),0),g=s.reduce((e,t)=>e+t.lessons.reduce((e,t)=>e+t._count.quizQuestions,0),0),q=s.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,3).map(e=>({id:e.id,title:e.title,lessonCount:e.lessons.length,subscriberCount:e.subscriptions.length})),m=s.flatMap(e=>e.lessons.filter(e=>e._count.exercises>0&&e._count.grades<e._count.exercises).map(t=>({id:t.id,number:t.number,title:t.title,courseId:e.id,courseTitle:e.title,exerciseCount:t._count.exercises,gradedCount:t._count.grades}))).slice(0,5);return n.Z.json({stats:{totalCourses:i,totalLessons:o,totalExercises:p,totalSubscribers:d,totalGrades:l,totalQuizAttempts:x,totalQuizQuestions:g},recentCourses:q,lessonsNeedingGrading:m},{status:200})}catch(e){return console.error("Error fetching instructor stats:",e),n.Z.json({error:"Failed to fetch statistics"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/instructor/stats/route",pathname:"/api/instructor/stats",filename:"route",bundlePath:"app/api/instructor/stats/route"},resolvedPagePath:"C:\\Users\\admin\\projects\\grading-app\\app\\api\\instructor\\stats\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:x,headerHooks:g,staticGenerationBailout:q}=p,m="/api/instructor/stats/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[657,8557,5798,7391,5226,8192],()=>__webpack_exec__(95803));module.exports=r})();