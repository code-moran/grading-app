"use strict";(()=>{var e={};e.id=5074,e.ids=[5074],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},26226:(e,r,i)=>{i.r(r),i.d(r,{headerHooks:()=>p,originalPathname:()=>P,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>m});var s={};i.r(s),i.d(s,{GET:()=>GET,POST:()=>POST});var t=i(10884),n=i(16132),o=i(95798),a=i(15204);async function GET(e){try{let{searchParams:r}=new URL(e.url),i="true"===r.get("includeExercises"),s=r.get("courseId"),t={};s&&(t.courseId=s);let n=await a._.lesson.findMany({where:t,include:{course:{select:{id:!0,title:!0}},...i?{exercises:{include:{rubric:{include:{criteriaMappings:{include:{criteria:!0}},levelMappings:{include:{level:!0}}}}},orderBy:{title:"asc"}}}:{}},orderBy:{number:"asc"}}),u=n.map(e=>{let r={id:e.id,number:e.number,title:e.title,description:e.description||"",duration:e.duration||"",courseId:e.courseId,course:e.course};return i&&"exercises"in e&&e.exercises?{...r,exercises:e.exercises.map(e=>({id:e.id,title:e.title,description:e.description||"",maxPoints:e.maxPoints,rubric:{id:e.rubric.id,name:e.rubric.name,description:e.rubric.description||"",totalPoints:e.rubric.totalPoints,criteria:e.rubric.criteriaMappings.map(e=>({id:e.criteria.id,name:e.criteria.name,description:e.criteria.description||"",weight:e.criteria.weight})),levels:e.rubric.levelMappings.map(e=>({id:e.level.id,name:e.level.name,description:e.level.description||"",points:e.level.points,color:e.level.color||"bg-gray-100"}))}}))}:r});return o.Z.json({lessons:u})}catch(e){return console.error("Error fetching lessons:",e),o.Z.json({error:"Failed to fetch lessons"},{status:500})}}async function POST(e){try{let r=await e.json(),{number:i,title:s,description:t,duration:n,courseId:u}=r;if(!i||!s)return o.Z.json({error:"Lesson number and title are required"},{status:400});if(!u)return o.Z.json({error:"Course ID is required. Lessons must be assigned to a course."},{status:400});let c=await a._.course.findUnique({where:{id:u}});if(!c)return o.Z.json({error:"Course not found. Lessons must be assigned to a valid course."},{status:404});let l=await a._.lesson.findUnique({where:{number:i}});if(l)return o.Z.json({error:"Lesson with this number already exists"},{status:409});let d=await a._.lesson.create({data:{number:i,title:s,description:t||null,duration:n||null,courseId:u}}),p={id:d.id,number:d.number,title:d.title,description:d.description||"",duration:d.duration||"",courseId:d.courseId};return o.Z.json({lesson:p},{status:201})}catch(e){return console.error("Error creating lesson:",e),o.Z.json({error:"Failed to create lesson"},{status:500})}}let u=new t.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/lessons/route",pathname:"/api/lessons",filename:"route",bundlePath:"app/api/lessons/route"},resolvedPagePath:"C:\\Users\\admin\\projects\\grading-app\\app\\api\\lessons\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:d,headerHooks:p,staticGenerationBailout:m}=u,P="/api/lessons/route"},15204:(e,r,i)=>{i.d(r,{_:()=>n});var s=i(53524);let t=globalThis,n=t.prisma??new s.PrismaClient},16132:(e,r)=>{var i;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))}};var r=require("../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),i=r.X(0,[8557,5798],()=>__webpack_exec__(26226));module.exports=i})();