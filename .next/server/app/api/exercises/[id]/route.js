"use strict";(()=>{var e={};e.id=3621,e.ids=[3621],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},6720:(e,r,i)=>{i.r(r),i.d(r,{headerHooks:()=>m,originalPathname:()=>b,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>g});var t={};i.r(t),i.d(t,{DELETE:()=>DELETE,GET:()=>GET,PUT:()=>PUT});var s=i(10884),n=i(16132),o=i(95798),a=i(94020),c=i(8192),u=i(15204);async function GET(e,{params:r}){try{let e=await (0,a.getServerSession)(c.L);if(!e?.user)return o.Z.json({error:"Unauthorized"},{status:401});let i=e.user.role;if(!["instructor","admin"].includes(i))return o.Z.json({error:"Forbidden. Instructor or Admin access required."},{status:403});let t=await u._.exercise.findUnique({where:{id:r.id},include:{lesson:{select:{id:!0,number:!0,title:!0,course:{select:{id:!0,title:!0}}}},rubric:{include:{criteriaMappings:{include:{criteria:!0}},levelMappings:{include:{level:!0}}}},_count:{select:{grades:!0,exerciseSubmissions:!0}}}});if(!t)return o.Z.json({error:"Exercise not found"},{status:404});let s={id:t.id,title:t.title,description:t.description,maxPoints:t.maxPoints,lessonId:t.lessonId,lesson:t.lesson,rubric:{id:t.rubric.id,name:t.rubric.name,description:t.rubric.description,totalPoints:t.rubric.totalPoints,criteria:t.rubric.criteriaMappings.map(e=>({id:e.criteria.id,name:e.criteria.name,description:e.criteria.description,weight:e.criteria.weight})),levels:t.rubric.levelMappings.map(e=>({id:e.level.id,name:e.level.name,description:e.level.description,points:e.level.points,color:e.level.color}))},stats:{gradeCount:t._count.grades,submissionCount:t._count.exerciseSubmissions},createdAt:t.createdAt,updatedAt:t.updatedAt};return o.Z.json({exercise:s},{status:200})}catch(e){return console.error("Error fetching exercise:",e),o.Z.json({error:"Failed to fetch exercise"},{status:500})}}async function PUT(e,{params:r}){try{let i=await (0,a.getServerSession)(c.L);if(!i?.user)return o.Z.json({error:"Unauthorized"},{status:401});let t=i.user.role;if(!["instructor","admin"].includes(t))return o.Z.json({error:"Forbidden. Instructor or Admin access required."},{status:403});let s=await e.json(),{title:n,description:d,maxPoints:l,rubricId:p}=s,x=await u._.exercise.findUnique({where:{id:r.id}});if(!x)return o.Z.json({error:"Exercise not found"},{status:404});if(p){let e=await u._.rubric.findUnique({where:{id:p}});if(!e)return o.Z.json({error:"Rubric not found"},{status:404})}let m={};void 0!==n&&(m.title=n),void 0!==d&&(m.description=d),void 0!==l&&(m.maxPoints=l),void 0!==p&&(m.rubricId=p);let g=await u._.exercise.update({where:{id:r.id},data:m,include:{lesson:{select:{id:!0,number:!0,title:!0,course:{select:{id:!0,title:!0}}}},rubric:{include:{criteriaMappings:{include:{criteria:!0}},levelMappings:{include:{level:!0}}}},_count:{select:{grades:!0,exerciseSubmissions:!0}}}}),b={id:g.id,title:g.title,description:g.description,maxPoints:g.maxPoints,lessonId:g.lessonId,lesson:g.lesson,rubric:{id:g.rubric.id,name:g.rubric.name,description:g.rubric.description,totalPoints:g.rubric.totalPoints,criteria:g.rubric.criteriaMappings.map(e=>({id:e.criteria.id,name:e.criteria.name,description:e.criteria.description,weight:e.criteria.weight})),levels:g.rubric.levelMappings.map(e=>({id:e.level.id,name:e.level.name,description:e.level.description,points:e.level.points,color:e.level.color}))},stats:{gradeCount:g._count.grades,submissionCount:g._count.exerciseSubmissions},createdAt:g.createdAt,updatedAt:g.updatedAt};return o.Z.json({exercise:b},{status:200})}catch(e){return console.error("Error updating exercise:",e),o.Z.json({error:"Failed to update exercise"},{status:500})}}async function DELETE(e,{params:r}){try{let e=await (0,a.getServerSession)(c.L);if(!e?.user)return o.Z.json({error:"Unauthorized"},{status:401});let i=e.user.role;if(!["instructor","admin"].includes(i))return o.Z.json({error:"Forbidden. Instructor or Admin access required."},{status:403});let t=await u._.exercise.findUnique({where:{id:r.id}});if(!t)return o.Z.json({error:"Exercise not found"},{status:404});return await u._.exercise.delete({where:{id:r.id}}),o.Z.json({message:"Exercise deleted successfully"},{status:200})}catch(e){return console.error("Error deleting exercise:",e),o.Z.json({error:"Failed to delete exercise"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/exercises/[id]/route",pathname:"/api/exercises/[id]",filename:"route",bundlePath:"app/api/exercises/[id]/route"},resolvedPagePath:"C:\\Users\\admin\\projects\\grading-app\\app\\api\\exercises\\[id]\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:x,headerHooks:m,staticGenerationBailout:g}=d,b="/api/exercises/[id]/route"}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),i=r.X(0,[657,8557,5798,7391,5226,8192],()=>__webpack_exec__(6720));module.exports=i})();