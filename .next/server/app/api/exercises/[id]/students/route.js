"use strict";(()=>{var e={};e.id=9532,e.ids=[9532],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},58916:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>x,originalPathname:()=>h,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>g});var s={};t.r(s),t.d(s,{GET:()=>GET});var i=t(10884),n=t(16132),o=t(95798),a=t(94020),d=t(8192),u=t(15204);async function GET(e,{params:r}){try{let e=await (0,a.getServerSession)(d.L);if(!e?.user)return o.Z.json({error:"Unauthorized"},{status:401});let t=e.user.role;if(!["instructor","admin"].includes(t))return o.Z.json({error:"Forbidden. Instructor or Admin access required."},{status:403});let s=await u._.exercise.findUnique({where:{id:r.id},include:{lesson:{include:{course:{include:{subscriptions:{include:{user:{include:{studentProfile:{include:{cohort:!0}}}},student:{include:{cohort:!0}}}}}}}}}});if(!s)return o.Z.json({error:"Exercise not found"},{status:404});s.lesson.course.id;let i=[];for(let e of s.lesson.course.subscriptions){let r=null;e.user?.studentProfile?r=e.user.studentProfile:e.student&&(r=e.student),r&&i.push({id:r.id,name:r.name,email:r.email,registrationNumber:r.registrationNumber,cohortId:r.cohortId,cohort:r.cohort?{id:r.cohort.id,name:r.cohort.name}:null})}let n=Array.from(new Map(i.map(e=>[e.id,e])).values()),c=await Promise.all(n.map(async e=>{let t=await u._.exerciseSubmission.findFirst({where:{studentId:e.id,exerciseId:r.id},orderBy:{submittedAt:"desc"}}),s=await u._.grade.findUnique({where:{studentId_exerciseId:{studentId:e.id,exerciseId:r.id}},include:{gradeCriteria:{include:{criteria:!0,level:!0}}}});return{...e,submission:t?{id:t.id,githubUrl:t.githubUrl,codingStandards:t.codingStandards,status:t.status,submittedAt:t.submittedAt}:null,grade:s?{id:s.id,totalPoints:s.totalPoints,maxPossiblePoints:s.maxPossiblePoints,percentage:s.percentage,letterGrade:s.letterGrade,feedback:s.feedback,gradedBy:s.gradedBy,gradedAt:s.gradedAt,criteriaGrades:s.gradeCriteria.map(e=>({criteriaId:e.criteriaId,levelId:e.levelId,points:e.points,comments:e.comments,criteria:{id:e.criteria.id,name:e.criteria.name},level:{id:e.level.id,name:e.level.name,points:e.level.points}}))}:null}}));return o.Z.json({students:c},{status:200})}catch(e){return console.error("Error fetching students for exercise:",e),o.Z.json({error:"Failed to fetch students"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/exercises/[id]/students/route",pathname:"/api/exercises/[id]/students",filename:"route",bundlePath:"app/api/exercises/[id]/students/route"},resolvedPagePath:"C:\\Users\\admin\\projects\\grading-app\\app\\api\\exercises\\[id]\\students\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:m,headerHooks:x,staticGenerationBailout:g}=c,h="/api/exercises/[id]/students/route"}};var r=require("../../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[657,8557,5798,7391,5226,8192],()=>__webpack_exec__(58916));module.exports=t})();