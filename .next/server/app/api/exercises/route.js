"use strict";(()=>{var e={};e.id=7946,e.ids=[7946],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},42626:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>b,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>g});var i={};t.r(i),t.d(i,{GET:()=>GET,POST:()=>POST});var s=t(10884),n=t(16132),o=t(95798),a=t(94020),c=t(8192),u=t(15204);async function GET(e){try{let r=await (0,a.getServerSession)(c.L);if(!r?.user)return o.Z.json({error:"Unauthorized"},{status:401});let t=r.user.role;if(!["instructor","admin"].includes(t))return o.Z.json({error:"Forbidden. Instructor or Admin access required."},{status:403});let{searchParams:i}=new URL(e.url),s=i.get("lessonId"),n={};s&&(n.lessonId=s);let l=await u._.exercise.findMany({where:n,include:{lesson:{select:{id:!0,number:!0,title:!0,course:{select:{id:!0,title:!0}}}},rubric:{include:{criteriaMappings:{include:{criteria:!0}},levelMappings:{include:{level:!0}}}},_count:{select:{grades:!0,exerciseSubmissions:!0}}},orderBy:{createdAt:"desc"}}),d=l.map(e=>({id:e.id,title:e.title,description:e.description,maxPoints:e.maxPoints,lessonId:e.lessonId,lesson:e.lesson,rubric:{id:e.rubric.id,name:e.rubric.name,description:e.rubric.description,totalPoints:e.rubric.totalPoints,criteria:e.rubric.criteriaMappings.map(e=>({id:e.criteria.id,name:e.criteria.name,description:e.criteria.description,weight:e.criteria.weight})),levels:e.rubric.levelMappings.map(e=>({id:e.level.id,name:e.level.name,description:e.level.description,points:e.level.points,color:e.level.color}))},stats:{gradeCount:e._count.grades,submissionCount:e._count.exerciseSubmissions},createdAt:e.createdAt,updatedAt:e.updatedAt}));return o.Z.json({exercises:d},{status:200})}catch(e){return console.error("Error fetching exercises:",e),o.Z.json({error:"Failed to fetch exercises"},{status:500})}}async function POST(e){try{let r=await (0,a.getServerSession)(c.L);if(!r?.user)return o.Z.json({error:"Unauthorized"},{status:401});let t=r.user.role;if(!["instructor","admin"].includes(t))return o.Z.json({error:"Forbidden. Instructor or Admin access required."},{status:403});let i=await e.json(),{lessonId:s,title:n,description:l,maxPoints:d,rubricId:p}=i;if(!s||!n||!p)return o.Z.json({error:"Lesson ID, title, and rubric ID are required"},{status:400});let x=await u._.lesson.findUnique({where:{id:s},include:{course:{select:{id:!0,isActive:!0}}}});if(!x)return o.Z.json({error:"Lesson not found"},{status:404});if(!x.course)return o.Z.json({error:"Lesson is not linked to a valid course. Please assign the lesson to a course first."},{status:400});let m=await u._.rubric.findUnique({where:{id:p}});if(!m)return o.Z.json({error:"Rubric not found"},{status:404});let g=await u._.exercise.create({data:{lessonId:s,title:n,description:l||null,maxPoints:d||16,rubricId:p},include:{lesson:{select:{id:!0,number:!0,title:!0,course:{select:{id:!0,title:!0}}}},rubric:{include:{criteriaMappings:{include:{criteria:!0}},levelMappings:{include:{level:!0}}}},_count:{select:{grades:!0,exerciseSubmissions:!0}}}}),b={id:g.id,title:g.title,description:g.description,maxPoints:g.maxPoints,lessonId:g.lessonId,lesson:g.lesson,rubric:{id:g.rubric.id,name:g.rubric.name,description:g.rubric.description,totalPoints:g.rubric.totalPoints,criteria:g.rubric.criteriaMappings.map(e=>({id:e.criteria.id,name:e.criteria.name,description:e.criteria.description,weight:e.criteria.weight})),levels:g.rubric.levelMappings.map(e=>({id:e.level.id,name:e.level.name,description:e.level.description,points:e.level.points,color:e.level.color}))},stats:{gradeCount:g._count.grades,submissionCount:g._count.exerciseSubmissions},createdAt:g.createdAt,updatedAt:g.updatedAt};return o.Z.json({exercise:b},{status:201})}catch(e){return console.error("Error creating exercise:",e),o.Z.json({error:"Failed to create exercise"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/exercises/route",pathname:"/api/exercises",filename:"route",bundlePath:"app/api/exercises/route"},resolvedPagePath:"C:\\Users\\admin\\projects\\grading-app\\app\\api\\exercises\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:x,headerHooks:m,staticGenerationBailout:g}=l,b="/api/exercises/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[657,8557,5798,7391,5226,8192],()=>__webpack_exec__(42626));module.exports=t})();